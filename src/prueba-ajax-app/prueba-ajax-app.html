<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../components/input-ajax.html">
<link rel="import" href="../components/table-ajax.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">

<dom-module id="prueba-ajax-app">
  <template>
    <style>
      :host {
        display: block;
        font-family: Roboto;
      }
      .container {
        margin: auto;
        padding: 5%;
        background-color: #eaeaea;
        border-radius: 5px;
      }
      .row {
        margin: 2%;
        padding: 3%;
        background-color: #fff;
        border-radius: 5px;
        overflow: auto;
      }
    </style>
    <iron-ajax
     id="getAllContacts"
     auto
     url="http://localhost:8080/api/contactos"
     method="GET"
     handle-as="json"
     content-type="application/json"
     last-response="{{responseGetAllContacts}}">
    </iron-ajax>

    <iron-ajax
     id="getContact"
     url="http://localhost:8080/api/contacto/{{id}}"
     method="GET"
     handle-as="json"
     content-type="application/json"
     last-response="{{responseGetContact}}">
    </iron-ajax>

    <iron-ajax
     id="deleteContact"
     url="http://localhost:8080/api/contacto/{{id}}"
     method="DELETE"
     handle-as="json"
     content-type="application/json"
     on-response="handlerConfirmDeleteContact">
    </iron-ajax>

    <!-- <br>
    <p>Respuesta  - Add User: [[responseAdd]]</p>
    <br>
    <template is="dom-repeat" items="{{responseGetAllContacts}}" as="users">
      <h4>[[users.nombre]]</h4>
    </template> -->

    <div class="container">
      <div class="row">
        <input-ajax
          on-save-contact="handlerSaveContact"
          on-update-contact="handlerUpdateContact"
          obj-contact="{{responseGetContact}}"></input-ajax>
      </div>
      <div class="row">
        <table-ajax
          all-contacts="{{responseGetAllContacts}}"
          on-edit-contact="handlerEditContact"
          on-delete-contact="handlerDeleteContact"></table-ajax>
      </div>

    </div>

  </template>

  <script>
    class PruebaAjaxApp extends Polymer.Element {
      static get is() { return 'prueba-ajax-app'; }

      static get properties() {
        return {
          responseAdd: {
            type: String,
          },
          responseUpdate: {
            type: String,
          },
          responseGetAllContacts: {
            type: Array,
          },
          responseGetContact: {
            type: String,
          },
          id: {
            type: Number,
          },
        };
      }

      handlerSaveContact(e) {
        console.log(e);
        this.responseAdd = JSON.stringify(e.detail.response);
        this.refreshContacts();
      }

      handlerUpdateContact(e) {
        console.log(e);
        this.responseUpdate = JSON.stringify(e.detail.response);
        this.refreshContacts();
      }

      handlerEditContact(e) {
        this.id = e.detail;
        this.$.getContact.generateRequest();
      }

      handlerDeleteContact(e) {
        this.id = e.detail;
        this.$.deleteContact.generateRequest();
      }

      handlerConfirmDeleteContact(e) {
        console.log('Contacto eliminado.');
        this.refreshContacts();
      }

      refreshContacts() {
        this.$.getAllContacts.generateRequest();
      }

    }

    window.customElements.define(PruebaAjaxApp.is, PruebaAjaxApp);
  </script>
</dom-module>
